FROM python:3.10-slim

# Prevent Python from generating .pyc files and enable output buffering
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Set the working directory
WORKDIR /workspace

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    build-essential \
    git \
    && rm -rf /var/lib/apt/lists/*

# Create a non-root user
RUN groupadd --gid 1000 fly \
    && useradd --uid 1000 --gid fly --shell /bin/bash --create-home fly

# Copy requirements file
COPY requirements.txt .

# Upgrade pip and install dependencies
RUN pip install --upgrade pip && pip install -r requirements.txt



# Change ownership of workspace to fly user
RUN chown -R fly:fly /workspace

# Switch to non-root user
USER fly

# Expose port 8000
EXPOSE 8000

# Default command runs dummy.py to keep the container running
CMD ["python", "dummy.py"]